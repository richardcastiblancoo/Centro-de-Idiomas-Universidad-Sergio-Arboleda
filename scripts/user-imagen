CREATE TABLE public.user_images (
    id uuid NOT NULL DEFAULT uuid_generate_v4(),
    user_id uuid NOT NULL,
    image_type text NOT NULL,
    image_url text NOT NULL,
    original_filename text,
    file_size bigint,
    mime_type text,
    uploaded_at timestamp with time zone NOT NULL DEFAULT now(),
    is_active boolean NOT NULL DEFAULT true,
    CONSTRAINT user_images_pkey PRIMARY KEY (id),
    CONSTRAINT user_images_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id) ON DELETE CASCADE
);

ALTER TABLE public.user_images ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow authenticated users to view their own images" ON public.user_images
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Allow authenticated users to insert their own images" ON public.user_images
  FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Allow authenticated users to update their own images" ON public.user_images
  FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Allow authenticated users to delete their own images" ON public.user_images
  FOR DELETE USING (auth.uid() = user_id);